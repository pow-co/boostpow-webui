<style>
  .button-text {
    color: white;
  }
  .align-right {
    float:right;
    margin-left: 1em;
  }
</style>

<section class="">
  <h1><%= gettext "Proof of Work", name: "Phoenix" %></h1>
  <p>Mining memes for a better world</p>
  <div id="paypresto"></div>
  <div id="moneybutton"></div>
  <div id="relayx-button"></div>
</section>

<section class="row">

  <%= if @mined do %>
    <h2>Recent Mined Boosts</h2>
  <% else %>
    <h2>Recent Boost Jobs Not Mined</h2>
  <% end %>
  <button>
    <a class='button-text align-right' href="/jobs/new">
      + Post New Job
    </a>
  </button>

</section>

<section class="row">
 
  <table>
    <thead>
      <hr>
        <td>
          Content
        </td>
        <td>
          Difficulty
        </td>
        <td>
          Reward
        </td>
        <td>
          <%= if @mined do %>
            <%= link("Mined?", to: "/jobs/not_mined") %>
          <% else %>
            <%= link("Mined?", to: "/jobs/mined") %>
          <% end %>
        </td>
      </hr>
    </thead>
    <%= for item <- @jobs do %>
    <tr>
      <td>
        <button>
          <a class='button-text' href="https://whatsonchain.com/tx/<%=item.txid%>", target="_blank">
            View Job
          </a>
        </button>
        <button>
          <a class='button-text' href="https://whatsonchain.com/tx/<%=item.content%>", target="_blank">
            View Content
          </a>
        </button>
      </td>
      <td>
          <%= item.difficulty %>
      </td>
      <td>
          <%= item.value %>
      </td>
      <td>
          <%= if item.spent do %>
            <%= if item.spend_txid do %>
              <button>
                <a class='button-text' href="https://whatsonchain.com/tx/<%=item.spend_txid%>", target="_blank">
                  View Proof
                </a>
              </button>
            <% else %>
              <p>✓</p>
            <% end %>
          <% else %>
            <p>✘</p>
          <% end %>
      </td>
    </tr>
    <% end %>
  </table>

</section>

<script>

  $(document).ready(() => {

      console.log('ready')

    $('#mined_toggle').change(function() {
      console.log(this.checked)
    })

  })

</script>

<script>
  const {Presto, embed} = Paypresto

  //let script = '08626f6f7374706f7775040000000020dbe0f0cdeb0e399dde37764cdc84415d51c95a01c42a0037a3c639c7ae4fe0b304c0bd001d14726570617065746968770000000000000000000004000000002000000000000000000000000000000000000000000000000000000000000000007e7c557a766b7e52796b557a8254887e557a8258887e7c7eaa7c6b7e7e7c8254887e6c7e7c8254887eaa01007e816c825488537f7681530121a5696b768100a0691d00000000000000000000000000000000000000000000000000000000007e6c539458959901007e819f6976a96c88ac'
  //let script = '626f6f7374706f77 OP_DROP 00000000 dbe0f0cdeb0e399dde37764cdc84415d51c95a01c42a0037a3c639c7ae4fe0b3 c0bd001d 7265706170657469687700000000000000000000 00000000 0000000000000000000000000000000000000000000000000000000000000000 OP_CAT OP_SWAP OP_5 OP_ROLL OP_DUP OP_TOALTSTACK OP_CAT OP_2 OP_PICK OP_TOALTSTACK OP_5 OP_ROLL OP_SIZE OP_4 OP_EQUALVERIFY OP_CAT OP_5 OP_ROLL OP_SIZE OP_8 OP_EQUALVERIFY OP_CAT OP_SWAP OP_CAT OP_HASH256 OP_SWAP OP_TOALTSTACK OP_CAT OP_CAT OP_SWAP OP_SIZE OP_4 OP_EQUALVERIFY OP_CAT OP_FROMALTSTACK OP_CAT OP_SWAP OP_SIZE OP_4 OP_EQUALVERIFY OP_CAT OP_HASH256 00 OP_CAT OP_BIN2NUM OP_FROMALTSTACK OP_SIZE OP_4 OP_EQUALVERIFY OP_3 OP_SPLIT OP_DUP OP_BIN2NUM OP_3 21 OP_WITHIN OP_VERIFY OP_TOALTSTACK OP_DUP OP_BIN2NUM 0 OP_GREATERTHAN OP_VERIFY 0000000000000000000000000000000000000000000000000000000000 OP_CAT OP_FROMALTSTACK OP_3 OP_SUB OP_8 OP_MUL OP_RSHIFT 00 OP_CAT OP_BIN2NUM OP_LESSTHAN OP_VERIFY OP_DUP OP_HASH160 OP_FROMALTSTACK OP_EQUALVERIFY OP_CHECKSIG'

  /*
  const payment = Presto.create({
    key: 'Kx2p4o7FYJYjEwufdYJLXjPtu2vaSpQ8mB7mjMJnaHnPSrGQ1nQk',
    description: 'Proof of Work',
    outputs: [
      { to: '1ErZaNaYtbUSfyXK8yc9dvH2ofMpw8r7DT', satoshis: 10000 },
      { script, satoshis: 10000 }
    ]
  })
 */

  /*
  const div = document.getElementById('moneybutton')
  moneyButton.render(div, {
    to: script,
    amount: 0.0001,
    currency: "BSV",
    onPayment: (arg) => {
      console.log('onPayment', arg)
    },
    onError: (arg) => { console.log('onError', arg) }
  })
  const relaydiv = document.querySelector('#relayx-button')
  relayone.render(relaydiv, {
    to: script,
    amount: 0.0001,
    currency: "BSV"
  })

  payment
    .mount(embed('#paypresto'))
    .on('funded', payment => payment.pushTx())
    .on('success', txid => {

       console.log('TX sent', txid)

        setTimeout(() => {

          $('#paypresto').innerHTML = null

        }, 1000)

     })
 */

</script>
